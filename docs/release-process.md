# Release Process

This guide summarizes how to publish Provenance application releases and Helm chart updates using the bundled automation.

## Prerequisites

- Write access to the repository and GitHub Container Registry (`ghcr.io/<org>/charts`).
- Updated `charts/provenance/Chart.yaml` and application version metadata committed to `main`.
- Successful CI run on the commit you plan to release.

## 1. Run Tests & Lint Locally (optional)

Although the release workflow repeats these steps, you can pre-flight locally:

```bash
uv sync --all-extras
uv run -- pytest
make helm-lint
make helm-template
```

## 2. Publish a Release (app + chart)

Trigger the **Release** workflow (`.github/workflows/release.yml`) from the GitHub Actions tab or via the CLI:

```bash
gh workflow run Release \
  --ref main \
  --field version=1.2.3 \
  --field chart_version=0.3.0
```

The workflow:

1. Checks out `main` and installs dependencies.
2. Runs the Python test suite and Helm lint/template checks.
3. Packages the Helm chart and pushes it to `ghcr.io/<org>/charts`.
4. Creates a GitHub release tagged `v<version>` with automatically generated notes.
5. Uploads the packaged chart (`provenance-<chart_version>.tgz`) as a release asset.

## 3. Publish the Chart Only (optional)

If you need to republish the chart without cutting a full app release, use the **Release Helm Chart** workflow (`.github/workflows/release-chart.yml`). It packages the chart and pushes it to the OCI registry without creating a Git tag or release entry.

```bash
gh workflow run "Release Helm Chart" \
  --ref main \
  --field version=0.3.0 \
  --field app_version=1.0.0
```

## 4. Verify Artifacts

- Check the GitHub release page for the new tag, autogenerated notes, and the chart `.tgz` asset.
- Confirm the OCI package exists: `helm pull oci://ghcr.io/<org>/charts/provenance --version 0.3.0`.

## 5. Announce / Deploy

- Notify stakeholders or trigger downstream deployment pipelines as required.
- Update changelogs or internal docs if you maintain long-form release notes beyond the generated summary.

## Troubleshooting

- **Helm push failures** – Ensure `packages: write` permission is granted and the registry path matches your org or user.
- **Version mismatch** – The release workflow will stop if `chart_version` input does not match `Chart.yaml`. Keep `Chart.yaml` in sync before starting the workflow.
- **Existing tag** – The GitHub release step fails if `v<version>` already exists. Delete the tag or choose a new version.

For additional deployment details, see the [Deployment & Operations Guide](deployment-guide.md) and [Helm chart README](../charts/provenance/README.md).
